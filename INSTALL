# Titan2D Installation
# ====================================================================
# Developer installation guide
# ====================================================================
#
# first lets make directory where all dependencies will be installed:
mkdir titan_wsp
cd titan_wsp

# for simplicity lets set this directory as TITAN_WSP
export TITAN_WSP=`pwd`

#lets make directory where all dependencies source code will be compiled
mkdir bld
cd bld


# ====================================================================
# Python installation
# ====================================================================

# Download, untar and compile python:
cd $TITAN_WSP/bld
wget https://www.python.org/ftp/python/2.7.9/Python-2.7.9.tar.xz
tar -xJf Python-2.7.9.tar.xz
cd Python-2.7.9
export TITAN_PYTHON=$TITAN_WSP/Python-2.7.9
./configure --prefix=$TITAN_PYTHON --enable-shared
make -j 8

# after that stage python can complain that some of the modules was not 
# successfully compiled, usually thouse modules are not needed for titan
# bellow is example of such complains: 
#    Python build finished, but the necessary bits to build these modules were not found:
#    _bsddb             bsddb185           bz2             
#    dbm                dl                 gdbm            
#    imageop            readline           sunaudiodev     

# instal python
make install

# ====================================================================
# Swig installation
# ====================================================================
#
# swig is a tool for building python API
# 
# Download, untar, compile and instal python:
cd $TITAN_WSP/bld
wget http://prdownloads.sourceforge.net/swig/swig-3.0.5.tar.gz
tar xvzf swig-3.0.5.tar.gz
cd swig-3.0.5
export TITAN_SWIG=$TITAN_WSP/swig-3.0.5 
./configure --prefix=$TITAN_SWIG  --with-python=$TITAN_PYTHON/bin/python
make -j 8
make install

# ====================================================================
# hdf5 installation
# ====================================================================
# serial version of hdf5 needed to be installed 
export TITAN_HDF5=$TITAN_WSP/hdf5

# ====================================================================
# GRASS installation
# ====================================================================

# ====================================================================
# titan2d installation
# ====================================================================
#
# Now as all dependecies are installed, titan2d can be compiled
cd $TITAN_WSP
git clone https://github.com/TITAN2D/titan2d.git
cd titan2d

# If you are installing titan2d from github repository you need first
# to generate all autotools scripts (i.e. configure script and others).
# Execute following in top source directory:
aclocal;autoheader;autoconf;automake --add-missing --copy

# Now you need to configure the installation. Titan2D support out of 
# source compilation. Execute configure in building directory, for
# example:
cd $TITAN_WSP
mkdir titan2d_bld
cd titan2d_bld
mkdir iccopt
cd iccopt

../../titan2d/configure --with-grass=<path_to_grass_installation> --without-gdal \
--with-hdf5=<path_to_top_dir_of_hdf5> --prefix=<where_to_install>  \
CC=mpicc CXX=mpic++ F77=mpif90 PYTHON=<path to python2.7>

# Now compile it:
make -j <number of proccesses to use>

# And install it:
make install

#

